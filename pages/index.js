import Head from 'next/head';
import Header from '../components/Header/Header';
import Hero from '../components/Hero/Hero';
import HeroCards from '../components/HeroCards/HeroCards';
import Products from '../components/Products/Products';

export default function Home({ products, user }) {
  console.log(products);
  console.log(user);

  return (
    <div>
      <Head>
        <title>Aerolab Store</title>
        <meta name='description' content='Generated by create next app' />
        <link rel='icon' href='/favicon.svg' />
      </Head>
      <Header user={user} />
      <Hero />
      <HeroCards />
      <Products products={products} user={user} />
    </div>
  );
}

//GET PRODUCTS && USER

export async function getServerSideProps() {
  const res = await fetch('https://coding-challenge-api.aerolab.co/products', {
    headers: {
      'Content-Type': 'application/json',
      Accept: 'application/json',
      Authorization: `Bearer ${process.env.REACT_APP_AEROLAB_TOKEN}`,
    },
  });

  const resUser = await fetch(
    'https://coding-challenge-api.aerolab.co/user/me',
    {
      headers: {
        'Content-Type': 'application/json',
        Accept: 'application/json',
        Authorization: `Bearer ${process.env.REACT_APP_AEROLAB_TOKEN}`,
      },
    }
  );

  const products = await res.json();
  const user = await resUser.json();

  return { props: { products, user } };
}
